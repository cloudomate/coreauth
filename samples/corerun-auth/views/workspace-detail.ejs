<%- include('header') %>
<nav class="text-sm text-gray-500 mb-4">
  <a href="/workspaces" class="hover:text-indigo-600">Workspaces</a>
  <span class="mx-2">/</span>
  <span class="text-gray-900"><%= workspace.name %></span>
</nav>

<div class="flex items-start justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-gray-900"><%= workspace.name %></h1>
    <% if (workspace.description) { %>
    <p class="text-sm text-gray-500 mt-1"><%= workspace.description %></p>
    <% } %>
    <div class="flex items-center gap-4 mt-2 text-xs text-gray-400">
      <span>Region: <strong class="text-gray-600"><%= workspace.region %></strong></span>
      <span>Owner: <strong class="text-gray-600"><%= workspace.owner_email %></strong></span>
      <span>Created: <%= new Date(workspace.created_at).toLocaleDateString() %></span>
    </div>
  </div>
  <% if (isAdmin) { %>
  <form method="POST" action="/workspaces/<%= workspace.id %>/delete" onsubmit="return confirm('Delete this workspace and all resources?')">
    <button type="submit" class="px-3 py-1.5 bg-red-50 text-red-600 border border-red-200 rounded-lg text-sm font-medium hover:bg-red-100 transition-colors">
      Delete Workspace
    </button>
  </form>
  <% } %>
</div>

<!-- Resource categories -->
<%
  const categories = [
    {
      name: 'Compute', color: 'blue',
      types: [
        { key: 'compute_instance', label: 'Instances', count: counts.compute_instance || 0 },
        { key: 'compute_function', label: 'Functions', count: counts.compute_function || 0 },
      ]
    },
    {
      name: 'Storage', color: 'green',
      types: [
        { key: 'storage_bucket', label: 'Buckets', count: counts.storage_bucket || 0 },
        { key: 'storage_volume', label: 'Volumes', count: counts.storage_volume || 0 },
        { key: 'storage_database', label: 'Databases', count: counts.storage_database || 0 },
      ]
    },
    {
      name: 'Networking', color: 'purple',
      types: [
        { key: 'network_vpc', label: 'VPCs', count: counts.network_vpc || 0 },
        { key: 'network_subnet', label: 'Subnets', count: counts.network_subnet || 0 },
        { key: 'network_firewall', label: 'Firewalls', count: counts.network_firewall || 0 },
        { key: 'network_lb', label: 'Load Balancers', count: counts.network_lb || 0 },
      ]
    },
  ];
%>

<div class="space-y-6 mb-8">
  <% categories.forEach(function(cat) { %>
  <div>
    <h2 class="text-lg font-semibold text-gray-900 mb-3"><%= cat.name %></h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-<%= cat.types.length > 3 ? 4 : cat.types.length %> gap-3">
      <% cat.types.forEach(function(t) { %>
      <a href="/workspaces/<%= workspace.id %>/resources/<%= t.key %>"
         class="bg-white rounded-xl border border-gray-200 p-4 hover:border-<%= cat.color %>-300 hover:shadow-sm transition-all flex items-center justify-between">
        <div>
          <p class="font-medium text-gray-900"><%= t.label %></p>
          <p class="text-sm text-gray-500 mt-0.5"><%= t.count %> resource<%= t.count !== 1 ? 's' : '' %></p>
        </div>
        <span class="text-2xl font-bold text-<%= cat.color %>-600"><%= t.count %></span>
      </a>
      <% }) %>
    </div>
  </div>
  <% }) %>
</div>

<!-- Collaborators & Share -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <!-- Current collaborators -->
  <div class="bg-white rounded-xl border border-gray-200 p-5">
    <h3 class="font-semibold text-gray-900 mb-3">Collaborators</h3>
    <% if (collaborators.length === 0) { %>
    <p class="text-sm text-gray-500">No collaborators yet.</p>
    <% } else { %>
    <div class="space-y-2">
      <% collaborators.forEach(function(c) { %>
      <div class="flex items-center justify-between py-1.5">
        <span class="text-sm text-gray-700 font-mono"><%= c.userId %></span>
        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
          <%= c.relation === 'admin' ? 'bg-indigo-100 text-indigo-700' : '' %>
          <%= c.relation === 'member' ? 'bg-green-100 text-green-700' : '' %>
          <%= c.relation === 'viewer' ? 'bg-gray-100 text-gray-700' : '' %>
          <%= c.relation === 'billing_admin' ? 'bg-yellow-100 text-yellow-700' : '' %>
        "><%= c.relation %></span>
      </div>
      <% }) %>
    </div>
    <% } %>
  </div>

  <!-- Share form -->
  <% if (isAdmin) { %>
  <div class="bg-white rounded-xl border border-gray-200 p-5">
    <h3 class="font-semibold text-gray-900 mb-3">Share Workspace</h3>
    <form method="POST" action="/workspaces/<%= workspace.id %>/share" class="space-y-3">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">User ID</label>
        <input type="text" name="user_id" required
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
          placeholder="User ID from admin panel">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
        <select name="relation" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          <option value="viewer">Viewer (read-only)</option>
          <option value="member">Member (create resources)</option>
          <option value="admin">Admin (full control)</option>
        </select>
      </div>
      <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 transition-colors">
        Share
      </button>
    </form>
    <p class="mt-3 text-xs text-gray-400">
      <strong>Admin</strong> inherits owner on all resources.
      <strong>Viewer</strong> can view all resources.
    </p>
  </div>
  <% } %>
</div>
<%- include('footer') %>
